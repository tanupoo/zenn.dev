---
title: "LoRaWAN: IXMã‚’ TPCPã«ã¤ãªã„ã§ã¿ã‚‹ã€‚"
emoji: "ğŸ¦"
type: "tech"
topics: [Cisco, LoRaWAN, Actility, ThingPark]
published: true
created: "2022-03-17"
---

Actility ThingPark Community Platform (TPCP) ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã®ã§ã€Cisco LoRaWAN Gateway (IXM) ã‚’æ¥ç¶šã—ã¦ã¿ã‚‹ã€‚

IXMã®è¨­å®šã¯çµ‚ã‚ã‚‰ã›ã¦ãŠãã€‚
ä¾‹ãˆã°ã€"[Cisco LoRaWAN Gatewayã®è¨­å®šã®ä¾‹](/tanupoo/articles/lorawan-cisco-gateway-config)"ã‚’å‚ç…§ã®ã“ã¨ã€‚
å…¬å¼ã¯ã€[ã“ã¡ã‚‰](https://www.cisco.com/c/ja_jp/support/routers/interface-module-lorawan/series.html)ã€‚

## TPCPã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹ã€‚

æœ€åˆã« https://community.thingpark.org/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã€**Sign Up**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-001.png)

ä»–ã®Actilityãƒ—ãƒ©ãƒƒãƒˆãƒ›ãƒ¼ãƒ ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã€ãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å†åˆ©ç”¨ã§ãã‚‹ã‚‰ã—ã„ã€‚è©¦ã—ã¦ãªã„ã€‚
æ··ãœã‚‹ã¨ãƒãƒã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã®ã§åˆ¥é€”ä½œã£ãŸã€‚

ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ä¸‹è¨˜ã®ãƒšãƒ¼ã‚¸ã«å…¥ã‚Œã‚‹æ§˜ã«ãªã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-002.png)

èˆˆå‘³ã‚ã‚‹äººã¯ã€LoRaWANã¨Actilityã¨ThingParkã«ã¤ã„ã¦çŸ¥ã£ã¦ãŠã„ã¦æã¯ãªã„ã€‚
ã“ã“ã§ã¯ã€**Step 3: Build your first end-to-end use case** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…ˆã«é€²ã‚€ã€‚

ãã®å…ˆã®ãƒšãƒ¼ã‚¸ã®**Step 4: Create the Gateway on Your Account**ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦GWã‚’ç™»éŒ²ã™ã‚‹ã€‚

## TPCPã« IXMã‚’ç™»éŒ²ã™ã‚‹ã€‚

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å·¦ã®ãƒªã‚¹ãƒˆã®ä¸­ã® **Base Stations**ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ **Create**ãŒç¾ã‚Œã‚‹ã®ã§ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-003.png)

**CREATING BASE STATION**ã¨ã„ã†ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€å³ä¸‹ã® **View More Manufactures**ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-004.png)

Ciscoã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-005.png)

Ciscoã®GWã‚’ç™»éŒ²ã™ã‚‹ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€åˆã‚ã«ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã™ã‚‹ã€‚
ã“ã“ã§ã¯ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ç‰ˆã‚’ä½¿ã†ã®ã§ **Macro V2.0 Standalone** ã‚’é¸æŠã™ã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-006.png)

ç¶šã„ã¦ã€
- **Name**: GWã®åå‰ã‚’å…¥åŠ›ã™ã‚‹ã€‚ä½•ã§ã‚‚ã‚ˆã„ã€‚å¾Œã‹ã‚‰å¤‰ãˆã‚‰ã‚Œã‚‹ã€‚
- **LRR-UUID**: IXM-CLIã§ *show packet-forwarder info*ã‚³ãƒãƒ³ãƒ‰ãªã©ã§è¡¨ç¤ºã•ã‚Œã‚‹ **LRRUUID** ã‚’å…¥åŠ›ã™ã‚‹ã€‚å–å¾—æ–¹æ³•ã¯ã€"[Cisco LoRaWAN Gateway: LRRã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚](/tanupoo/articles/lorawan-cisco-gateway-config-lrr)"ã‚’å‚ç…§ã®ã“ã¨ã€‚
- **RF Region**: *Japan 8-channels 20mW*ã‚’é¸æŠã™ã‚‹ã€‚å¾Œã‹ã‚‰å¤‰ãˆã‚‰ã‚Œã‚‹ã€‚
- **IPsec**: enabledã‚’é¸æŠã™ã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-007.png)

- **Disable public key authentication**: ãƒã‚§ãƒƒã‚¯ãŒ**å¤–ã‚Œã¦ã„ã‚‹**ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
- **Public key**: SUPLOGã® *Get public key* ã§å–å¾—ã—ãŸå…¬é–‹éµã‚’å…¥åŠ›ã™ã‚‹ã€‚å–å¾—æ–¹æ³•ã¯ã€"[Cisco LoRaWAN Gateway: LRRã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚](/tanupoo/articles/lorawan-cisco-gateway-config-lrr)"ã‚’å‚ç…§ã®ã“ã¨ã€‚
- **Mode**: GPSã‚·ã‚°ãƒŠãƒ«ãŒå–ã‚Œã‚‹å ´æ‰€ã«ç½®ã„ã¦ã‚ã‚Œã°ã€*Onboard GNSS position*ã‚’é¸æŠã™ã‚‹ã¨ã‚ˆã„ã€‚å¾Œã‹ã‚‰å¤‰ãˆã‚‰ã‚Œã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-008.png)

**CREATE**ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ç™»éŒ²ãŒå®Œäº†ã™ã‚‹ã€‚
![](/images/lorawan-cisco-gateway-tpcp-009.png)

## ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æº–å‚™ã™ã‚‹ã€‚

IXMã§LRRã‚’å‹•ã‹ã™å‰ã«ã€IXMãŒæ¥ç¶šã•ã‚Œã¦ã„ã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’è¨­å®šã™ã‚‹ã€‚

- NTP, DNSã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
    + NTP: UDP 123
    + DNS: UDP 53

- IKEv2ã¨NAT Traversalã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
    + IKEv2: UDP 500
    + NAT Traversal: UDP 4500
    + ä¸‹è¨˜2ã¤ã®ãƒ›ã‚¹ãƒˆãŒIPsecãƒˆãƒ³ãƒãƒ«ã®çµ‚ç«¯ã«ãªã‚‹ã€‚
        + slrc1-poc.thingpark.com 52.47.178.109
        + slrc2-poc.thingpark.com 35.180.224.119

- IPsecã‚’ä½¿ã‚ãªã„å ´åˆ
    + å‹•ããã†ã ã‘ã©æœªæ¤œè¨¼ã€‚
    + FTP (TCP port 21)ã‚’é€šã™å¿…è¦ãŒã‚ã‚‹ã€‚

## LRRã‚’èµ·å‹•ã™ã‚‹ã€‚

LRRã‚’èµ·å‹•ã™ã‚‹ã€‚

ã™ã§ã«èµ·å‹•ã—ã¦ã„ãŸã‚‰ã€æ­¢ã‚ã¦èµ·å‹•ã—ãªãŠã™ã€‚

ã¾ãšã€èµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã€‚

```
GW#show packet-forwarder status
Status : Stopped
```

ã“ã“ã§ Runningã¨ãªã£ã¦ã„ãŸã‚‰ã€ä¸‹è¨˜ã®æ§˜ã«æ­¢ã‚ã‚‹ã€‚

```
GW#configure terminal 
GW(config)#packet-forwarder stop
Stopped packet-forwarder
```

LRRã‚’èµ·å‹•ã™ã‚‹ã€‚

```
GW(config)#packet-forwarder start
Started packet-forwarder
GW(config)#exit
```

èµ·å‹•ã—ãŸã‹ç¢ºèªã™ã‚‹ã€‚

```
GW#show packet-forwarder status
Status : Running
```

IPsecãƒˆãƒ³ãƒãƒ«ãŒå¼µã‚‰ã‚ŒãŸå¾Œã«ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ°ã‚‹ã€‚
NSå´ã§ Status ãŒ ACTIVEã«ãªã‚Œã°æˆåŠŸã€‚
æ•°åˆ†ã‹ã‹ã‚‹ã€‚

![](/images/lorawan-cisco-gateway-tpcp-016.png)

## LRRèµ·å‹•å¾Œã®IXMã®è¨­å®š

IPsecã®è¨­å®šãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã€‚

```
GW#show running-config 
!
enable secret 8 ****
!
hostname GW
container log all
!
crypto ipsec profile primary
 ipaddr slrc1-poc.thingpark.com iketime 86400 keytime 82800 aes 128
 subnet 10.152.12.0/24
 rightid CN=slrc1_aws-eu-eco_actility-tpe-ope
 exit
ip domain lookup
!
ip name-server 8.8.8.8
!
crypto ipsec profile secondary
 ipaddr slrc2-poc.thingpark.com iketime 86400 keytime 82800 aes 128
 subnet 10.152.22.0/24
 rightid CN=slrc2_aws-eu-eco_actility-tpe-ope
 exit
!
interface FastEthernet 0/1
 description Ethernet
 ip address 10.0.0.7 255.255.255.0
 exit
!
ip default-gateway 10.0.0.1
!
username **** password 8 ****
!
username **** password 8 ****
!
ip ssh admin-access
ip ssh port 22
!
ntp server ip ntp.nict.jp
!
clock timezone Asia/Tokyo
ipsec lxc-restart-disable
ipsec cert install local enable
ipsec enable
```

## LRRã®ãƒ­ã‚°ã«ã¤ã„ã¦

LRRã®ãƒ­ã‚°ã‚’è¦‹ã‚‹ã«ã¯ã€IOSã‹ã‚‰ show packet-forwarderã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã€‚

```
GW#show packet-forwarder log name trace 250
```

ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨éå»7æ—¥é–“ã®ãƒ­ã‚°ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
UNIXç³»OSã‚’ä½¿ã„æ…£ã‚Œã¦ã„ãªã„äººã¯ãŠå‹§ã‚ã—ãªã„ã€‚è‡ªå·±è²¬ä»»ã§ã€‚

*$ROOTACT/var/log/lrr/TRACE.log* ã« LRRã®ãƒ­ã‚°ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã€‚

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªãƒ­ã‚°ã¯ä¸‹è¨˜ã‚³ãƒãƒ³ãƒ‰ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
çµ‚äº†ã¯ `Ctrl+C` ã‚’æŠ¼ã™ã€‚

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã«ã‚ˆã£ã¦ã¯ `Ctrl+C`ãŒåŠ¹ã‹ãªã„å ´åˆãŒã‚ã‚‹ã€‚
sttyã§è¨­å®šã™ã‚‹ã€‚è‡ªå·±è²¬ä»»ã§ã€‚

```
bash-3.2# tail -f $ROOTACT/var/log/lrr/TRACE.log
```

éå»ã®ãƒ­ã‚°ã¯ä¸‹è¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã™ã‚‹ã€‚
1æ—¥ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤‰ã‚ã‚‹ã€‚
ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¯ **TRACE_NN.log**
*NN*ã¯ 01ã‹ã‚‰ 07ã¾ã§ã€‚
01ãŒæœˆæ›œæ—¥ã«è©²å½“ã™ã‚‹ã€‚

## Trouble Shooting: `ERROR: received LrrID==0 from twa lrcid=201 idxlrc=0`

ä¸‹è¨˜ã®æ§˜ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºç¶šã‘ã¦ã€NSå´ã§è¦‹ã‚‹ã¨ç™»éŒ²ãŒå®Œäº†ã—ãªã„ã€‚

```
01:14:37.211  (00880) [../main.c:4001] LAP LRC STARTED
01:14:37.211  (00880) [../main.c:4005] Get LrrID: from bootserver = 0, from twa = 1, lrrid=00000000
01:14:37.211  (00880) [../main.c:567] LRR send lrruid='005F86-024B069606FCF' to lrc='(null)' twa sz=284 idxlrc=1
01:14:37.463  (00880) [../main.c:4043] LAP RECV sz=28 szh=28 psz=0 lrrid=000000ca typ=32/32768(I) tms=0 rqtdelay=0
01:14:37.463  (00880) [../main.c:3560] get lrrid=00000000 from twa lrcuid=202 idxlrc=1
01:14:37.463  (00880) [../main.c:3593] ERROR: received LrrID==0 from twa lrcid=202 idxlrc=1 ! => retry later
01:14:41.543  (00880) [../main.c:6686] On timer failed to get lrrid from twa => lrrid '69606fcf' used
```

TWAã¯èªè¨¼ã‚µãƒ¼ãƒã€‚
åˆ¥ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã€‚

åˆ¥ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç™»éŒ²ã‚’å‰Šé™¤ã—ã¦ã—ã°ã‚‰ãå¾…ã¤ã€‚
ãŸã ã—ã€12æ™‚é–“ã§ã¯æ”¹å–„ã—ãªã‹ã£ãŸã€‚
TPCPã‹ã‚‰å‰Šé™¤ã—ã¦ã‚„ã‚ŠãªãŠã—ã¦ã‚‚æ”¹å–„ã—ãªã‹ã£ãŸã€‚
1æ—¥çµŒéã™ã‚‹ã¨ã¤ãªãŒã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

## Trouble Shooting: packet-forwarder firmware is not installed

packet forwarderã®çŠ¶æ…‹ãŒè¦‹ã‚Œãªã„ã€‚

```
GW#show packet-forwarder status
packet-forwarder firmware is not installed
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¤±æ•—ã—ã¦ã„ã‚‹ã€‚
ã‚ã‚ŠãŒã¡ãªã®ãŒä¸‹è¨˜ã®æ§˜ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’é–“é•ãˆã¦ã„ã‚‹ã€‚

```
GW(config)#packet-forwarder install firmware TP_Enterprise_BS_Image_cisco.C
ISCO_CIXM.1_any_TPCP_SAAS_2.6.53_v1.0_no-keygen.cpkg
packet-forwarder firmware validation failed
```

## Trouble Shooting: NSã«ã¤ãªãŒã‚‰ãªã„ã€‚

20åˆ†ãŸã£ã¦ã‚‚ã¤ãªãŒã‚‰ãªã„å ´åˆã€ä¸‹è¨˜ã®ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ã€‚

```
16:07:43.393  (31526) [../main.c:6164] no LRC connection during more than 1200sec => revssh
```

LRCã¾ã§ã®æ¥ç¶šæ€§ãŒãªã„ã€‚
åŸºæœ¬çš„ãªãƒã‚§ãƒƒã‚¯ã‚’ã—ã¦ã‚‚ã¤ãªãŒã‚‰ãªã„å ´åˆã¯ã€IPsecã®è¨­å®šãŒé–“é•ã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

## Trouble Shooting: One session to container console is already open.

ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã€ã‚³ãƒ³ãƒ†ãƒŠã«ã¤ãªãŒã‚‰ãªã„ã€‚

```
GW#request shell container-console 
Enter System Password:  
One session to container console is already open.
Only one session to container console is allowed.
```

ã‚³ãƒ³ãƒ†ãƒŠã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæ®‹ã£ã¦ã„ã‚‹ã€‚

ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã™ã‚‹ã€‚

```
GW(config)#container disable 
Reset Container's private network...
Container is stopped.
```

```
GW(config)#no container disable 
Container is started.
```

ãŸã ã—ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’å†èµ·å‹•ã™ã‚‹ã¨GPSã‚¢ãƒ³ãƒ†ãƒŠã®ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ããªããªã‚‹å ´åˆãŒã‚ã‚‹ã€‚
ãã®éš›ã¯IXMã‚’å†èµ·å‹•ã™ã‚‹ã€‚

## Trouble Shooting: cannot open gps device

```
15:26:52.872  (03554) [../gps.c:202] ERROR: opening TTY port for GPS failed - Too many levels of symbolic links (/dev/ttyS1)
15:26:52.872  (03554) [../gps.c:180] GPS cannot open gps device '/dev/ttyS1'
```

GPSã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ãã¦ã„ãªã„ã€‚
IXMã‚’å†èµ·å‹•ã™ã‚‹ã€‚

## Trouble Shooting: RADIO cannot be started

```
15:27:18.453  (26629) [../lgw_x8.c:1282] BOARD1 RADIO cannot be started ret=-1 'Invalid version number for the top FPGA'
```

radio off ã«ãªã£ã¦ã„ã‚‹ã€‚

